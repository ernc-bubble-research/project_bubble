<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Architect Review Package â€” Bubble</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fafafa;
    --surface: #ffffff;
    --text: #1a1a2e;
    --text-secondary: #555;
    --accent: #2563eb;
    --accent-light: #dbeafe;
    --border: #e2e8f0;
    --flag-bg: #fef3c7;
    --flag-border: #f59e0b;
    --flag-text: #92400e;
    --critical-bg: #fef2f2;
    --critical-border: #ef4444;
    --critical-text: #991b1b;
    --code-bg: #f1f5f9;
    --pre-bg: #0f172a;
    --pre-text: #e2e8f0;
    --toc-bg: #f8fafc;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'IBM Plex Sans', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
    font-size: 15px;
  }

  .container {
    max-width: 920px;
    margin: 0 auto;
    padding: 40px 32px 80px;
  }

  /* Header */
  .doc-header {
    border-bottom: 3px solid var(--accent);
    padding-bottom: 24px;
    margin-bottom: 40px;
  }
  .doc-header h1 {
    font-size: 28px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
    letter-spacing: -0.5px;
  }
  .doc-header .subtitle {
    font-size: 18px;
    color: var(--accent);
    font-weight: 500;
    margin-bottom: 16px;
  }
  .doc-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    font-size: 13px;
    color: var(--text-secondary);
  }
  .doc-meta span { display: flex; align-items: center; gap: 6px; }
  .doc-meta code {
    font-family: 'IBM Plex Mono', monospace;
    background: var(--code-bg);
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 12px;
  }

  /* Table of Contents */
  .toc {
    background: var(--toc-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px 28px;
    margin-bottom: 48px;
  }
  .toc h2 {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-secondary);
    margin-bottom: 14px;
    font-weight: 600;
  }
  .toc ol {
    list-style: none;
    counter-reset: toc;
    columns: 2;
    column-gap: 32px;
  }
  .toc li {
    counter-increment: toc;
    margin-bottom: 6px;
  }
  .toc li::before {
    content: counter(toc) ".";
    color: var(--accent);
    font-weight: 600;
    margin-right: 8px;
    font-size: 13px;
  }
  .toc a {
    color: var(--text);
    text-decoration: none;
    font-size: 14px;
  }
  .toc a:hover { color: var(--accent); }

  /* Sections */
  .section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 32px;
    margin-bottom: 32px;
  }

  h2 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--accent-light);
    letter-spacing: -0.3px;
  }
  h2 .section-num {
    color: var(--accent);
    margin-right: 6px;
  }

  h3 {
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
    margin-top: 28px;
    margin-bottom: 12px;
  }
  h3:first-of-type { margin-top: 0; }

  h4 {
    font-size: 14px;
    font-weight: 600;
    margin-top: 20px;
    margin-bottom: 8px;
  }

  p { margin-bottom: 12px; }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
    font-size: 13.5px;
  }
  thead th {
    background: var(--code-bg);
    text-align: left;
    padding: 10px 14px;
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-secondary);
    border-bottom: 2px solid var(--border);
  }
  tbody td {
    padding: 9px 14px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }
  tbody tr:last-child td { border-bottom: none; }
  tbody tr:hover { background: #f8fafc; }
  td code, th code {
    font-family: 'IBM Plex Mono', monospace;
    background: var(--code-bg);
    padding: 1px 5px;
    border-radius: 3px;
    font-size: 12px;
  }

  /* Code blocks */
  pre {
    background: var(--pre-bg);
    color: var(--pre-text);
    padding: 20px 24px;
    border-radius: 6px;
    overflow-x: auto;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12.5px;
    line-height: 1.6;
    margin: 16px 0;
    white-space: pre;
  }

  code {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
  }

  /* Inline code */
  p code, li code {
    background: var(--code-bg);
    padding: 1px 5px;
    border-radius: 3px;
    font-size: 12.5px;
  }

  /* Flag callouts */
  .flag {
    background: var(--flag-bg);
    border-left: 4px solid var(--flag-border);
    padding: 14px 18px;
    margin: 16px 0;
    border-radius: 0 6px 6px 0;
    font-size: 13.5px;
    color: var(--flag-text);
    line-height: 1.6;
  }
  .flag strong { color: var(--flag-border); }

  .flag-critical {
    background: var(--critical-bg);
    border-left-color: var(--critical-border);
    color: var(--critical-text);
  }
  .flag-critical strong { color: var(--critical-border); }

  .flag-security {
    background: #fef2f2;
    border-left-color: #dc2626;
    color: #991b1b;
  }
  .flag-security strong { color: #dc2626; }

  /* Lists */
  ul, ol {
    margin: 8px 0 12px 20px;
  }
  li {
    margin-bottom: 5px;
    font-size: 14px;
  }

  /* Architecture diagram */
  .diagram {
    background: var(--pre-bg);
    color: #94a3b8;
    padding: 24px;
    border-radius: 6px;
    overflow-x: auto;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11.5px;
    line-height: 1.4;
    margin: 16px 0;
    white-space: pre;
  }

  /* Summary cards */
  .summary-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
  }
  .summary-card {
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  .summary-card.good {
    border-left: 4px solid #22c55e;
  }
  .summary-card.decisions {
    border-left: 4px solid var(--accent);
  }
  .summary-card h3 {
    margin-top: 0;
    font-size: 14px;
    margin-bottom: 10px;
  }
  .summary-card ul { margin-left: 16px; }
  .summary-card li { font-size: 13px; }

  /* Priority badges */
  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .badge-critical { background: #fef2f2; color: #dc2626; }
  .badge-high { background: #fff7ed; color: #ea580c; }
  .badge-medium { background: #fefce8; color: #ca8a04; }
  .badge-low { background: #f0fdf4; color: #16a34a; }

  /* Print styles */
  @media print {
    body { font-size: 12px; }
    .container { max-width: 100%; padding: 20px; }
    .section { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; }
    .toc { break-after: page; }
    pre { font-size: 10px; }
  }

  @media (max-width: 700px) {
    .container { padding: 20px 16px; }
    .section { padding: 20px; }
    .toc ol { columns: 1; }
    .summary-grid { grid-template-columns: 1fr; }
    table { font-size: 12px; }
    thead th, tbody td { padding: 6px 8px; }
  }
</style>
</head>
<body>
<div class="container">

  <!-- Header -->
  <div class="doc-header">
    <h1>Architect Review Package</h1>
    <div class="subtitle">Bubble â€” AI-Powered Research Workflow Platform</div>
    <div class="doc-meta">
      <span>ğŸ“… 2026-02-05</span>
      <span>ğŸ” Full codebase + BMAD artifacts review</span>
      <span>ğŸŒ¿ Branch: <code>main</code> (<code>602a62c</code>)</span>
    </div>
  </div>

  <!-- Table of Contents -->
  <div class="toc">
    <h2>Contents</h2>
    <ol>
      <li><a href="#s1">Product Overview &amp; Phase 1 Scope</a></li>
      <li><a href="#s2">Architecture Overview</a></li>
      <li><a href="#s3">Full Tech Stack with Versions</a></li>
      <li><a href="#s4">Database Schema</a></li>
      <li><a href="#s5">API Route Inventory</a></li>
      <li><a href="#s6">Deployment Setup &amp; CI/CD</a></li>
      <li><a href="#s7">Folder Structure</a></li>
      <li><a href="#s8">Technical Debt &amp; Known Issues</a></li>
      <li><a href="#s9">Operational Gaps</a></li>
      <li><a href="#s10">Summary &amp; Architect Decisions</a></li>
    </ol>
  </div>

  <!-- Section 1 -->
  <div class="section" id="s1">
    <h2><span class="section-num">1.</span> Product Overview &amp; Phase 1 Scope</h2>

    <h3>What Bubble Is</h3>
    <p>Bubble is a multi-tenant SaaS platform that enables marketing research teams to run AI-powered workflows on their data. Users upload research materials (transcripts, documents), select a pre-built workflow (e.g., "Qualitative Data Analysis"), and receive structured reports with citations back to source material.</p>

    <h3>Core Value Proposition</h3>
    <ul>
      <li><strong>For Researchers:</strong> Replace weeks of manual qualitative analysis with AI-generated reports that cite their sources</li>
      <li><strong>For Admins:</strong> Define reusable YAML-based workflow templates that non-technical users can execute through a guided wizard</li>
      <li><strong>For Organizations:</strong> Multi-tenant architecture with strict data isolation (PostgreSQL RLS) and role-based access</li>
    </ul>

    <h3>Phase 1 (MVP) Scope</h3>
    <table>
      <thead><tr><th>Area</th><th>What's In</th><th>What's Out</th></tr></thead>
      <tbody>
        <tr><td>Workflows</td><td>Atomic workflows (single LLM call), chains (sequential composition)</td><td>LangGraph orchestration, conditional branching</td></tr>
        <tr><td>File Support</td><td>PDF, DOCX, TXT, MD, CSV (text extraction)</td><td>Image/OCR, video, audio transcription</td></tr>
        <tr><td>LLM Providers</td><td>Google Gemini (primary), OpenAI (fallback), Mock (testing)</td><td>Self-hosted models, Azure OpenAI</td></tr>
        <tr><td>Knowledge</td><td>pgvector RAG with cosine similarity</td><td>Knowledge graph (nodes + edges), hybrid search</td></tr>
        <tr><td>Reports</td><td>Markdown with inline citations</td><td>PDF export, slide deck generation</td></tr>
        <tr><td>Sharing</td><td>Magic links (read-only, time-limited)</td><td>Collaborative editing, comments</td></tr>
        <tr><td>Auth</td><td>JWT + RBAC (3 roles)</td><td>OAuth/SSO, MFA, SAML</td></tr>
      </tbody>
    </table>

    <h3>User Roles</h3>
    <table>
      <thead><tr><th>Role</th><th>Scope</th><th>Access</th></tr></thead>
      <tbody>
        <tr><td>Bubble Admin</td><td>Global</td><td>Tenant management, system settings, LLM config, impersonation</td></tr>
        <tr><td>Customer Admin</td><td>Tenant</td><td>User management, billing, tenant settings</td></tr>
        <tr><td>Creator</td><td>Tenant</td><td>Run workflows, upload files, view reports</td></tr>
        <tr><td>Guest</td><td>Report</td><td>Read-only report access via magic link (Phase 1 deferred)</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Section 2 -->
  <div class="section" id="s2">
    <h2><span class="section-num">2.</span> Architecture Overview</h2>

    <h3>System Architecture</h3>
    <div class="diagram">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                                 â”‚
â”‚  Angular 21 SPA (apps/web)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ Zone A   â”‚ â”‚ Zone B   â”‚ â”‚ Zone C   â”‚                        â”‚
â”‚  â”‚ /auth    â”‚ â”‚ /app     â”‚ â”‚ /admin   â”‚                        â”‚
â”‚  â”‚ (Public) â”‚ â”‚ (Tenant) â”‚ â”‚ (Admin)  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚             â”‚             â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                       â”‚ HTTP + JWT                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API GATEWAY (apps/api-gateway)                  â”‚
â”‚  NestJS 11 â€” Port 3000                                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Guards  â”‚â†’â”‚ Interceptors â”‚â†’â”‚ Controllers  â”‚                â”‚
â”‚  â”‚ JWT     â”‚  â”‚ TenantContextâ”‚  â”‚ 16 total     â”‚                â”‚
â”‚  â”‚ Roles   â”‚  â”‚ (RLS setup)  â”‚  â”‚              â”‚                â”‚
â”‚  â”‚ API Key â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚                         â”‚
â”‚                                        â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              Services + TransactionManager           â”‚        â”‚
â”‚  â”‚  (All DB access via TransactionManager.run())       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                         â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚            â–¼            â–¼            â–¼                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚  BullMQ  â”‚                     â”‚
â”‚     â”‚ + RLS    â”‚ â”‚ (cache)  â”‚ â”‚ (jobs)   â”‚                     â”‚
â”‚     â”‚+pgvector â”‚ â”‚          â”‚ â”‚          â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               WORKER ENGINE (apps/worker-engine)                  â”‚
â”‚  NestJS 11 â€” Port 3001                                           â”‚
â”‚  BullMQ processor for async jobs (ingestion, workflow execution) â”‚
â”‚  âš  Currently empty shell â€” jobs run in api-gateway for MVP      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

    <h3>Data Flow: User Runs a Workflow</h3>
    <pre>1. User selects workflow from Storefront (/app/workflows)
2. Run Wizard collects inputs (files, assets, form responses)
3. Frontend POSTs to /api/app/workflow-runs
4. API Gateway creates WorkflowRunEntity (status: queued)
5. Job dispatched to BullMQ queue
6. Worker picks up job:
   a. Fetches uploaded files (text extraction)
   b. Queries pgvector knowledge base (if RAG enabled)
   c. Assembles YAML prompt template + variables
   d. Calls LLM provider (Gemini/OpenAI/Mock)
   e. Validates output against OutputSchema
   f. Extracts citations â†’ materializes quotes
7. WorkflowRunEntity updated (status: completed, output stored)
8. User views interactive report with Evidence Drawer</pre>

    <h3>Key Architectural Decisions</h3>
    <table>
      <thead><tr><th>Decision</th><th>Choice</th><th>Rationale</th></tr></thead>
      <tbody>
        <tr><td>Monorepo</td><td>Nx workspace</td><td>Single repo for frontend, backend, shared libs</td></tr>
        <tr><td>Multi-tenancy</td><td>Shared DB + RLS</td><td>Cost-efficient; PostgreSQL RLS enforces isolation</td></tr>
        <tr><td>Auth</td><td>JWT (7-day expiry)</td><td>Stateless; refresh tokens deferred to Epic 7</td></tr>
        <tr><td>LLM integration</td><td>Hexagonal pattern</td><td>Provider-agnostic; swap implementations without code changes</td></tr>
        <tr><td>Job processing</td><td>BullMQ + Redis</td><td>Async workflow execution; retries built in</td></tr>
        <tr><td>Vector search</td><td>pgvector (HNSW)</td><td>PostgreSQL-native; no separate vector DB needed</td></tr>
        <tr><td>Workflow definition</td><td>YAML prompts</td><td>LLM-orchestrated execution; no LangGraph needed for MVP</td></tr>
        <tr><td>Frontend state</td><td>Angular Signals</td><td>No NgRx; signals sufficient for current complexity</td></tr>
        <tr><td>Styling</td><td>Custom design system</td><td>No UI framework (Material, PrimeNG); full control</td></tr>
        <tr><td>Testing</td><td>Jest (backend + frontend)</td><td>Vitest configured but not primary</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Section 3 -->
  <div class="section" id="s3">
    <h2><span class="section-num">3.</span> Full Tech Stack with Versions</h2>

    <h3>Runtime Dependencies</h3>
    <table>
      <thead><tr><th>Package</th><th>Version</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td colspan="3" style="font-weight:600; background:var(--code-bg);">Frontend</td></tr>
        <tr><td>@angular/core</td><td><code>~21.0.0</code></td><td>SPA framework</td></tr>
        <tr><td>@angular/router</td><td><code>~21.0.0</code></td><td>Client-side routing</td></tr>
        <tr><td>rxjs</td><td><code>^7.8.0</code></td><td>Reactive programming</td></tr>
        <tr><td>lucide-angular</td><td><code>^0.563.0</code></td><td>Icon library</td></tr>
        <tr><td>jwt-decode</td><td><code>^4.0.0</code></td><td>JWT parsing on client</td></tr>
        <tr><td colspan="3" style="font-weight:600; background:var(--code-bg);">Backend</td></tr>
        <tr><td>@nestjs/core</td><td><code>^11.0.0</code></td><td>API framework</td></tr>
        <tr><td>@nestjs/jwt</td><td><code>^11.0.2</code></td><td>JWT authentication</td></tr>
        <tr><td>@nestjs/passport</td><td><code>^11.0.5</code></td><td>Auth strategies</td></tr>
        <tr><td>@nestjs/swagger</td><td><code>^11.2.5</code></td><td>API documentation</td></tr>
        <tr><td>@nestjs/throttler</td><td><code>^6.5.0</code></td><td>Rate limiting</td></tr>
        <tr><td>@nestjs/typeorm</td><td><code>^11.0.0</code></td><td>ORM integration</td></tr>
        <tr><td>@nestjs/bullmq</td><td><code>^11.0.4</code></td><td>Job queue integration</td></tr>
        <tr><td>typeorm</td><td><code>^0.3.28</code></td><td>Database ORM</td></tr>
        <tr><td>pg</td><td><code>^8.17.2</code></td><td>PostgreSQL driver</td></tr>
        <tr><td>bullmq</td><td><code>^5.66.5</code></td><td>Job queue</td></tr>
        <tr><td>bcrypt</td><td><code>^6.0.0</code></td><td>Password hashing</td></tr>
        <tr><td>helmet</td><td><code>^8.1.0</code></td><td>HTTP security headers</td></tr>
        <tr><td>passport-jwt</td><td><code>^4.0.1</code></td><td>JWT passport strategy</td></tr>
        <tr><td colspan="3" style="font-weight:600; background:var(--code-bg);">LLM / AI</td></tr>
        <tr><td>@google/generative-ai</td><td><code>^0.24.1</code></td><td>Gemini API client</td></tr>
        <tr><td colspan="3" style="font-weight:600; background:var(--code-bg);">Document Processing</td></tr>
        <tr><td>mammoth</td><td><code>^1.11.0</code></td><td>DOCX â†’ text</td></tr>
        <tr><td>pdf-parse</td><td><code>^2.4.5</code></td><td>PDF â†’ text</td></tr>
        <tr><td>sanitize-html</td><td><code>^2.17.0</code></td><td>XSS prevention</td></tr>
        <tr><td colspan="3" style="font-weight:600; background:var(--code-bg);">Email</td></tr>
        <tr><td>nodemailer</td><td><code>^7.0.13</code></td><td>SMTP email sending</td></tr>
        <tr><td colspan="3" style="font-weight:600; background:var(--code-bg);">Shared</td></tr>
        <tr><td>class-validator</td><td><code>^0.14.3</code></td><td>DTO validation</td></tr>
        <tr><td>class-transformer</td><td><code>^0.5.1</code></td><td>DTO transformation</td></tr>
        <tr><td>tslib</td><td><code>^2.3.0</code></td><td>TypeScript runtime helpers</td></tr>
      </tbody>
    </table>

    <h3>Build &amp; Dev Dependencies</h3>
    <table>
      <thead><tr><th>Package</th><th>Version</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td>typescript</td><td><code>~5.9.2</code></td><td>Language</td></tr>
        <tr><td>nx</td><td><code>22.3.3</code></td><td>Monorepo orchestration</td></tr>
        <tr><td>jest</td><td><code>^30.0.2</code></td><td>Unit testing</td></tr>
        <tr><td>cypress</td><td><code>^15.8.0</code></td><td>E2E testing (configured, not used)</td></tr>
        <tr><td>vitest</td><td><code>^4.0.8</code></td><td>Alternative test runner</td></tr>
        <tr><td>vite</td><td><code>^7.0.0</code></td><td>Build tool</td></tr>
        <tr><td>eslint</td><td><code>^9.8.0</code></td><td>Linting (flat config)</td></tr>
        <tr><td>prettier</td><td><code>~3.6.2</code></td><td>Code formatting</td></tr>
        <tr><td>tailwindcss</td><td><code>^3.0.2</code></td><td>CSS utility (installed, not actively used)</td></tr>
      </tbody>
    </table>

    <h3>Infrastructure</h3>
    <table>
      <thead><tr><th>Component</th><th>Image/Version</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td>PostgreSQL</td><td><code>pgvector/pgvector:pg16</code></td><td>Primary database with vector extension</td></tr>
        <tr><td>Redis</td><td><code>redis:alpine</code></td><td>Job queue backend + caching</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Section 4 -->
  <div class="section" id="s4">
    <h2><span class="section-num">4.</span> Database Schema</h2>

    <h3>Entity Summary</h3>
    <table>
      <thead><tr><th>Entity</th><th>Table</th><th>Columns</th><th>RLS</th><th>Soft Delete</th></tr></thead>
      <tbody>
        <tr><td>TenantEntity</td><td><code>tenants</code></td><td>10</td><td>NO</td><td>NO</td></tr>
        <tr><td>UserEntity</td><td><code>users</code></td><td>11</td><td>YES</td><td>NO</td></tr>
        <tr><td>InvitationEntity</td><td><code>invitations</code></td><td>12</td><td>YES</td><td>NO</td></tr>
        <tr><td>AssetEntity</td><td><code>assets</code></td><td>15</td><td>YES</td><td>NO</td></tr>
        <tr><td>FolderEntity</td><td><code>folders</code></td><td>5</td><td>YES</td><td>NO</td></tr>
        <tr><td>KnowledgeChunkEntity</td><td><code>knowledge_chunks</code></td><td>10</td><td>YES</td><td>NO</td></tr>
        <tr><td>WorkflowTemplateEntity</td><td><code>workflow_templates</code></td><td>12</td><td>YES</td><td>YES</td></tr>
        <tr><td>WorkflowVersionEntity</td><td><code>workflow_versions</code></td><td>6</td><td>YES</td><td>NO</td></tr>
        <tr><td>WorkflowChainEntity</td><td><code>workflow_chains</code></td><td>12</td><td>YES</td><td>YES</td></tr>
        <tr><td>WorkflowRunEntity</td><td><code>workflow_runs</code></td><td>20</td><td>YES</td><td>NO</td></tr>
        <tr><td>LlmModelEntity</td><td><code>llm_models</code></td><td>10</td><td>NO</td><td>NO</td></tr>
      </tbody>
    </table>

    <h3>RLS Policies (Explicit)</h3>

    <h4>Standard Tenant Isolation (7 tables)</h4>
    <p>Applied to: <code>users</code>, <code>invitations</code>, <code>assets</code>, <code>folders</code>, <code>knowledge_chunks</code>, <code>workflow_versions</code>, <code>workflow_runs</code></p>
    <pre>-- Policy: tenant_isolation_{table}
-- Type: USING (applies to all operations)
tenant_id = current_setting('app.current_tenant', true)::uuid</pre>
    <p>RLS is ENABLED with FORCE on all 7 tables. The <code>app.current_tenant</code> session variable is set per-transaction via <code>TransactionManager.run()</code> â†’ <code>SET LOCAL app.current_tenant = $1</code>.</p>

    <h4>Auth Bypass Policies (Permissive)</h4>
    <table>
      <thead><tr><th>Policy</th><th>Table</th><th>Operation</th><th>Condition</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td><code>auth_select_all</code></td><td>users</td><td>SELECT</td><td><code>true</code></td><td>Pre-auth login queries</td></tr>
        <tr><td><code>auth_insert_users</code></td><td>users</td><td>INSERT</td><td><code>true</code></td><td>User creation (seed, invitation accept)</td></tr>
        <tr><td><code>auth_accept_invitations</code></td><td>invitations</td><td>SELECT</td><td><code>true</code></td><td>Pre-auth invitation lookup</td></tr>
        <tr><td><code>auth_update_invitations</code></td><td>invitations</td><td>UPDATE</td><td><code>true</code></td><td>Invitation status updates</td></tr>
      </tbody>
    </table>

    <div class="flag flag-security">
      <strong>ğŸ” SECURITY FLAG:</strong> These policies use <code>condition: true</code>, meaning <strong>any database connection</strong> â€” regardless of tenant context â€” can SELECT all users and all invitations. This is intentional for the pre-authentication flow (login needs to find users by email across all tenants, invitation accept needs to look up tokens globally). However:
      <ol style="margin-top:8px;">
        <li><strong><code>auth_select_all</code> on <code>users</code>:</strong> Any query without <code>SET LOCAL app.current_tenant</code> can read the entire users table (emails, password hashes, roles). The application layer (AuthService) is the only barrier.</li>
        <li><strong><code>auth_insert_users</code>:</strong> Any connection can INSERT into users without tenant context. The application validates tenant existence, but the DB won't reject orphan inserts.</li>
        <li><strong>Mitigation:</strong> The <code>bypassRls</code> flag in TenantContext is only set for <code>bubble_admin</code> role. Regular service calls go through <code>TransactionManager.run()</code> which always sets the tenant context.</li>
        <li><strong>Recommended:</strong> Consider restricting these permissive policies to specific database roles (e.g., a dedicated <code>auth_user</code> DB role with limited permissions vs. the <code>app_user</code> role used for tenant-scoped queries).</li>
      </ol>
    </div>

    <h4>Custom Visibility Policies (2 tables)</h4>
    <p>Applied to: <code>workflow_templates</code>, <code>workflow_chains</code></p>
    <pre>-- Policy: template_access / chain_access
-- Type: SELECT (Using)
tenant_id = current_setting('app.current_tenant', true)::uuid
OR visibility = 'public'
OR current_setting('app.current_tenant', true)::uuid = ANY(allowed_tenants)</pre>

    <h4>Tables Without RLS</h4>
    <table>
      <thead><tr><th>Table</th><th>Reason</th></tr></thead>
      <tbody>
        <tr><td><code>tenants</code></td><td>Root table â€” no tenant_id column</td></tr>
        <tr><td><code>llm_models</code></td><td>Global registry â€” shared across all tenants</td></tr>
      </tbody>
    </table>

    <h3>pgvector Configuration</h3>
    <ul>
      <li><strong>Column:</strong> <code>knowledge_chunks.embedding</code> â€” stored as <code>float8[]</code> in TypeORM, converted to <code>vector(768)</code> by RlsSetupService on startup</li>
      <li><strong>Index:</strong> HNSW on embedding column (cosine similarity)</li>
      <li><strong>Query:</strong> Raw SQL with <code>&lt;=&gt;</code> operator for cosine distance</li>
    </ul>

    <h3>Tenant Context Flow</h3>
    <pre>HTTP Request
  â†’ JwtAuthGuard (extracts user from JWT)
  â†’ TenantContextInterceptor (sets AsyncLocalStorage context)
    â†’ { tenantId: user.tenant_id, bypassRls: role === 'bubble_admin' }
  â†’ Controller â†’ Service â†’ TransactionManager.run()
    â†’ SET LOCAL app.current_tenant = $tenantId
    â†’ RLS policies automatically filter all queries</pre>
  </div>

  <!-- Section 5 -->
  <div class="section" id="s5">
    <h2><span class="section-num">5.</span> API Route Inventory</h2>

    <h3>Authentication</h3>
    <table>
      <thead><tr><th>Method</th><th>Path</th><th>Auth</th><th>Guard Chain</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td>POST</td><td><code>/api/auth/login</code></td><td>None</td><td>Throttle(5/60s)</td><td>User login</td></tr>
        <tr><td>POST</td><td><code>/api/auth/set-password</code></td><td>None</td><td>Throttle(5/60s)</td><td>Accept invitation</td></tr>
        <tr><td>GET</td><td><code>/api/</code></td><td>None</td><td>None</td><td>Health check</td></tr>
      </tbody>
    </table>

    <h3>Admin Routes (<code>/api/admin/*</code>)</h3>
    <p>All admin routes require: <code>OptionalJwtAuthGuard â†’ AdminApiKeyGuard â†’ RolesGuard(BUBBLE_ADMIN)</code></p>
    <p>Two auth paths: (1) JWT with <code>bubble_admin</code> role, or (2) <code>x-admin-api-key</code> header.</p>

    <table>
      <thead><tr><th>Method</th><th>Path</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td>POST</td><td><code>/api/admin/tenants</code></td><td>Create tenant</td></tr>
        <tr><td>GET</td><td><code>/api/admin/tenants</code></td><td>List all tenants</td></tr>
        <tr><td>GET</td><td><code>/api/admin/tenants/:id</code></td><td>Get tenant detail</td></tr>
        <tr><td>PATCH</td><td><code>/api/admin/tenants/:id</code></td><td>Update tenant</td></tr>
        <tr><td>POST</td><td><code>/api/admin/tenants/:id/impersonate</code></td><td>Impersonate tenant</td></tr>
        <tr><td>GET</td><td><code>/api/admin/tenants/:id/accessible-workflows</code></td><td>List tenant's accessible workflows</td></tr>
        <tr><td>POST</td><td><code>/api/admin/tenants/:tenantId/users</code></td><td>Create user in tenant</td></tr>
        <tr><td>GET</td><td><code>/api/admin/tenants/:tenantId/users</code></td><td>List tenant users</td></tr>
        <tr><td>PATCH</td><td><code>/api/admin/tenants/:tenantId/users/:id</code></td><td>Update user</td></tr>
        <tr><td>DELETE</td><td><code>/api/admin/tenants/:tenantId/users/:id</code></td><td>Deactivate user</td></tr>
        <tr><td>POST</td><td><code>/api/admin/tenants/:tenantId/users/:id/reset-password</code></td><td>Reset password</td></tr>
        <tr><td>POST</td><td><code>/api/admin/tenants/:tenantId/invitations</code></td><td>Create invitation</td></tr>
        <tr><td>GET</td><td><code>/api/admin/tenants/:tenantId/invitations</code></td><td>List invitations</td></tr>
        <tr><td>POST</td><td><code>/api/admin/tenants/:tenantId/invitations/:id/resend</code></td><td>Resend invitation</td></tr>
        <tr><td>DELETE</td><td><code>/api/admin/tenants/:tenantId/invitations/:id</code></td><td>Revoke invitation</td></tr>
        <tr><td>POST</td><td><code>/api/admin/workflow-templates</code></td><td>Create template</td></tr>
        <tr><td>GET</td><td><code>/api/admin/workflow-templates</code></td><td>List templates (filterable)</td></tr>
        <tr><td>GET</td><td><code>/api/admin/workflow-templates/:id</code></td><td>Get template + current version</td></tr>
        <tr><td>PATCH</td><td><code>/api/admin/workflow-templates/:id</code></td><td>Update template</td></tr>
        <tr><td>DELETE</td><td><code>/api/admin/workflow-templates/:id</code></td><td>Soft-delete template</td></tr>
        <tr><td>POST</td><td><code>/api/admin/workflow-templates/:id/restore</code></td><td>Restore template</td></tr>
        <tr><td>POST</td><td><code>/api/admin/workflow-templates/:id/publish</code></td><td>Publish version</td></tr>
        <tr><td>POST</td><td><code>/api/admin/workflow-templates/:id/rollback/:versionId</code></td><td>Rollback to version</td></tr>
        <tr><td>POST</td><td><code>/api/admin/workflow-templates/:templateId/versions</code></td><td>Create version</td></tr>
        <tr><td>GET</td><td><code>/api/admin/workflow-templates/:templateId/versions</code></td><td>List versions</td></tr>
        <tr><td>GET</td><td><code>/api/admin/workflow-templates/:templateId/versions/:versionId</code></td><td>Get version</td></tr>
        <tr><td>POST</td><td><code>/api/admin/workflow-chains</code></td><td>Create chain</td></tr>
        <tr><td>GET</td><td><code>/api/admin/workflow-chains</code></td><td>List chains (filterable)</td></tr>
        <tr><td>GET</td><td><code>/api/admin/workflow-chains/:id</code></td><td>Get chain</td></tr>
        <tr><td>PUT</td><td><code>/api/admin/workflow-chains/:id</code></td><td>Update chain</td></tr>
        <tr><td>DELETE</td><td><code>/api/admin/workflow-chains/:id</code></td><td>Soft-delete chain</td></tr>
        <tr><td>PATCH</td><td><code>/api/admin/workflow-chains/:id/restore</code></td><td>Restore chain</td></tr>
        <tr><td>PATCH</td><td><code>/api/admin/workflow-chains/:id/publish</code></td><td>Publish chain</td></tr>
        <tr><td>GET</td><td><code>/api/admin/llm-models</code></td><td>List all LLM models</td></tr>
        <tr><td>POST</td><td><code>/api/admin/llm-models</code></td><td>Create LLM model</td></tr>
        <tr><td>PATCH</td><td><code>/api/admin/llm-models/:id</code></td><td>Update LLM model</td></tr>
      </tbody>
    </table>

    <h3>App Routes (<code>/api/app/*</code>)</h3>
    <p>All app routes require: <code>JwtAuthGuard â†’ RolesGuard(BUBBLE_ADMIN, CUSTOMER_ADMIN, CREATOR)</code></p>

    <table>
      <thead><tr><th>Method</th><th>Path</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td>POST</td><td><code>/api/app/users</code></td><td>Create user (tenant-scoped)</td></tr>
        <tr><td>GET</td><td><code>/api/app/users</code></td><td>List users (tenant-scoped)</td></tr>
        <tr><td>PATCH</td><td><code>/api/app/users/:id</code></td><td>Update user</td></tr>
        <tr><td>DELETE</td><td><code>/api/app/users/:id</code></td><td>Deactivate user</td></tr>
        <tr><td>POST</td><td><code>/api/app/users/:id/reset-password</code></td><td>Reset password</td></tr>
        <tr><td>POST</td><td><code>/api/app/invitations</code></td><td>Create invitation (tenant-scoped)</td></tr>
        <tr><td>GET</td><td><code>/api/app/invitations</code></td><td>List invitations</td></tr>
        <tr><td>POST</td><td><code>/api/app/invitations/:id/resend</code></td><td>Resend invitation</td></tr>
        <tr><td>DELETE</td><td><code>/api/app/invitations/:id</code></td><td>Revoke invitation</td></tr>
        <tr><td>POST</td><td><code>/api/app/assets</code></td><td>Upload file (multipart, 10MB limit)</td></tr>
        <tr><td>GET</td><td><code>/api/app/assets</code></td><td>List assets (filterable by folder, status)</td></tr>
        <tr><td>GET</td><td><code>/api/app/assets/:id</code></td><td>Get asset</td></tr>
        <tr><td>PATCH</td><td><code>/api/app/assets/:id</code></td><td>Update asset</td></tr>
        <tr><td>DELETE</td><td><code>/api/app/assets/:id</code></td><td>Archive asset</td></tr>
        <tr><td>POST</td><td><code>/api/app/assets/:id/restore</code></td><td>Restore asset</td></tr>
        <tr><td>POST</td><td><code>/api/app/assets/:id/index</code></td><td>Queue for knowledge indexing (202)</td></tr>
        <tr><td>DELETE</td><td><code>/api/app/assets/:id/index</code></td><td>Remove from knowledge index</td></tr>
        <tr><td>POST</td><td><code>/api/app/folders</code></td><td>Create folder</td></tr>
        <tr><td>GET</td><td><code>/api/app/folders</code></td><td>List folders</td></tr>
        <tr><td>PATCH</td><td><code>/api/app/folders/:id</code></td><td>Update folder</td></tr>
        <tr><td>DELETE</td><td><code>/api/app/folders/:id</code></td><td>Delete folder</td></tr>
        <tr><td>POST</td><td><code>/api/app/knowledge/search</code></td><td>Semantic search</td></tr>
        <tr><td>POST</td><td><code>/api/app/knowledge/insights</code></td><td>Store validated insight</td></tr>
        <tr><td>GET</td><td><code>/api/app/knowledge/insights</code></td><td>List insights</td></tr>
        <tr><td>GET</td><td><code>/api/app/knowledge/insights/run/:runId</code></td><td>Get insights by run</td></tr>
        <tr><td>DELETE</td><td><code>/api/app/knowledge/insights/:id</code></td><td>Delete insight</td></tr>
        <tr><td>GET</td><td><code>/api/app/llm-models</code></td><td>List active LLM models</td></tr>
        <tr><td>GET</td><td><code>/api/app/workflow-templates</code></td><td>Browse published workflows (catalog)</td></tr>
      </tbody>
    </table>

    <h3>Rate Limiting</h3>
    <ul>
      <li>Global: 10 requests per 60 seconds (ThrottlerGuard)</li>
      <li>Login/set-password: 5 requests per 60 seconds (additional)</li>
    </ul>
  </div>

  <!-- Section 6 -->
  <div class="section" id="s6">
    <h2><span class="section-num">6.</span> Deployment Setup &amp; CI/CD</h2>

    <h3>Deployment Target</h3>
    <p><strong>No production deployment exists.</strong> The architecture doc mentions potential targets but no decision has been made:</p>
    <table>
      <thead><tr><th>Option Mentioned</th><th>Source</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td>Render / Railway / AWS AppRunner</td><td>architecture.md line 157</td><td>Mentioned, not decided</td></tr>
        <tr><td>Supabase or RDS</td><td>architecture.md line 120</td><td>Mentioned for managed PostgreSQL</td></tr>
        <tr><td>EU Region (Frankfurt/Dublin)</td><td>PRD NFRs</td><td>Required for GDPR compliance</td></tr>
      </tbody>
    </table>

    <div class="flag">
      <strong>âš  Flag:</strong> The project uses Google Vertex AI / Gemini as its primary LLM provider, which implies a GCP affinity. However, no explicit GCP deployment decision exists. The architect should decide on a target cloud and establish: container registry, managed PostgreSQL (Cloud SQL / RDS / Supabase), managed Redis (Memorystore / ElastiCache), and a compute target (Cloud Run / App Runner / Railway). This decision cascades into file storage, secrets management, and CI/CD choices.
    </div>

    <h3>Current Local Setup</h3>
    <pre># docker-compose.yml (development only)
services:
  postgres:
    image: pgvector/pgvector:pg16
    ports: ["5432:5432"]
    volumes: [postgres_data:/var/lib/postgresql/data]
    healthcheck: pg_isready -U bubble_user -d bubble_db

  redis:
    image: redis:alpine
    ports: ["6379:6379"]
    volumes: [redis_data:/data]</pre>
    <pre>docker compose up -d              # Start PostgreSQL + Redis
nx serve api-gateway              # Backend on :3000
nx serve web                      # Frontend on :4200 (proxies /api â†’ :3000)</pre>
    <p>No Dockerfiles exist for the application services themselves â€” only infrastructure containers.</p>

    <h3>File Storage Strategy</h3>
    <p><strong>Current: Local filesystem. Not production-ready.</strong></p>
    <p>Uploaded files are stored on the API gateway's local disk:</p>
    <pre>uploads/&lt;tenantId&gt;/&lt;uuid&gt;-&lt;sanitized-filename&gt;</pre>
    <ul>
      <li><strong>Upload handling:</strong> Multer with <code>memoryStorage()</code> â†’ file loaded into memory â†’ written to disk via <code>fs/promises.writeFile()</code></li>
      <li><strong>Max file size:</strong> 10MB (hardcoded in controller)</li>
      <li><strong>Allowed types:</strong> PDF, TXT, MD, DOCX only</li>
      <li><strong>Deduplication:</strong> SHA-256 hash per tenant prevents duplicate uploads</li>
      <li><strong>Tenant isolation:</strong> Files stored in tenant-specific subdirectories</li>
      <li><strong>Cleanup:</strong> Orphan file deleted if DB save fails</li>
    </ul>

    <div class="flag">
      <strong>âš  Flag:</strong> Local filesystem storage means: (1) files are lost if the container restarts without persistent volumes, (2) horizontal scaling is impossible (each instance has its own disk), (3) no backup/versioning, (4) no CDN for delivery. Migration to cloud object storage (GCS, S3) is required before production. The <code>AssetEntity.storage_path</code> column stores the relative path, so the migration is straightforward â€” swap the storage backend, keep the path format.
    </div>

    <h3>Secrets Management</h3>
    <p><strong>Current: <code>.env</code> files and environment variables. No secrets manager.</strong></p>
    <table>
      <thead><tr><th>Sensitive Variable</th><th>Current Handling</th></tr></thead>
      <tbody>
        <tr><td><code>JWT_SECRET</code></td><td>Env var; app refuses to start on default value</td></tr>
        <tr><td><code>ADMIN_API_KEY</code></td><td>Env var; app refuses to start on default value</td></tr>
        <tr><td><code>DATABASE_URL</code></td><td>Env var; contains password in connection string</td></tr>
        <tr><td><code>GEMINI_API_KEY</code></td><td>Env var; optional for dev (mock provider)</td></tr>
        <tr><td><code>SMTP_PASS</code></td><td>Env var; empty in dev</td></tr>
        <tr><td><code>POSTGRES_PASSWORD</code></td><td>Env var; <code>bubble_password</code> in dev</td></tr>
      </tbody>
    </table>

    <div class="flag">
      <strong>âš  Flag:</strong> No secrets rotation, no encryption at rest for credentials, no audit trail for secret access. For production: use the cloud provider's secrets manager, implement key rotation for JWT signing keys, and remove seed credentials from any deployed environment.
    </div>

    <h3>Environment Variables (25 total)</h3>
    <table>
      <thead><tr><th>Variable</th><th>Required</th><th>Default</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td><code>DATABASE_URL</code></td><td>Yes</td><td>-</td><td>PostgreSQL connection</td></tr>
        <tr><td><code>JWT_SECRET</code></td><td>Yes</td><td>-</td><td>JWT signing (fails on default)</td></tr>
        <tr><td><code>ADMIN_API_KEY</code></td><td>Yes</td><td>-</td><td>Admin API auth (fails on default)</td></tr>
        <tr><td><code>PORT</code></td><td>No</td><td>3000</td><td>API gateway port</td></tr>
        <tr><td><code>WORKER_PORT</code></td><td>No</td><td>3001</td><td>Worker engine port</td></tr>
        <tr><td><code>CORS_ORIGIN</code></td><td>No</td><td>http://localhost:4200</td><td>CORS allowed origin</td></tr>
        <tr><td><code>REDIS_HOST</code></td><td>No</td><td>localhost</td><td>Redis host</td></tr>
        <tr><td><code>REDIS_PORT</code></td><td>No</td><td>6379</td><td>Redis port</td></tr>
        <tr><td><code>POSTGRES_HOST</code></td><td>No</td><td>localhost</td><td>DB host</td></tr>
        <tr><td><code>POSTGRES_PORT</code></td><td>No</td><td>5432</td><td>DB port</td></tr>
        <tr><td><code>POSTGRES_USER</code></td><td>No</td><td>bubble_user</td><td>DB user</td></tr>
        <tr><td><code>POSTGRES_PASSWORD</code></td><td>No</td><td>bubble_password</td><td>DB password</td></tr>
        <tr><td><code>POSTGRES_DB</code></td><td>No</td><td>bubble_db</td><td>DB name</td></tr>
        <tr><td><code>SEED_ADMIN_EMAIL</code></td><td>No</td><td>admin@bubble.io</td><td>Dev seed user</td></tr>
        <tr><td><code>SEED_ADMIN_PASSWORD</code></td><td>No</td><td>Admin123!</td><td>Dev seed password</td></tr>
        <tr><td><code>SMTP_HOST</code></td><td>No</td><td>sandbox.smtp.mailtrap.io</td><td>Email provider</td></tr>
        <tr><td><code>SMTP_PORT</code></td><td>No</td><td>2525</td><td>SMTP port</td></tr>
        <tr><td><code>SMTP_USER</code></td><td>No</td><td>-</td><td>SMTP credentials</td></tr>
        <tr><td><code>SMTP_PASS</code></td><td>No</td><td>-</td><td>SMTP credentials</td></tr>
        <tr><td><code>SMTP_FROM</code></td><td>No</td><td>noreply@bubble.app</td><td>Email sender</td></tr>
        <tr><td><code>FRONTEND_URL</code></td><td>No</td><td>http://localhost:4200</td><td>Invitation link base</td></tr>
        <tr><td><code>INVITATION_EXPIRY_HOURS</code></td><td>No</td><td>72</td><td>Invitation TTL</td></tr>
        <tr><td><code>GEMINI_API_KEY</code></td><td>No</td><td>-</td><td>Google AI Studio key</td></tr>
        <tr><td><code>EMBEDDING_PROVIDER</code></td><td>No</td><td>mock</td><td>Embedding backend</td></tr>
        <tr><td><code>EMBEDDING_MODEL</code></td><td>No</td><td>text-embedding-004</td><td>Embedding model ID</td></tr>
        <tr><td><code>CHUNK_SIZE</code></td><td>No</td><td>2000</td><td>Text chunk size</td></tr>
        <tr><td><code>CHUNK_OVERLAP</code></td><td>No</td><td>400</td><td>Chunk overlap</td></tr>
      </tbody>
    </table>

    <h3>Backup &amp; Disaster Recovery</h3>
    <p><strong>Not implemented. No strategy documented.</strong></p>
    <ul>
      <li>PostgreSQL data persists in a Docker volume (<code>postgres_data</code>) â€” no automated backups</li>
      <li>Redis data persists in a Docker volume (<code>redis_data</code>) â€” no persistence config beyond default</li>
      <li>Uploaded files on local filesystem â€” no backup</li>
      <li>Knowledge Base snapshots mentioned as <code>[Future]</code> in architecture docs (FR24, FR25) â€” not implemented</li>
    </ul>

    <div class="flag flag-critical">
      <strong>ğŸš¨ Flag:</strong> A single <code>docker compose down -v</code> destroys all data. For production: automated pg_dump or managed DB backups with point-in-time recovery, cloud storage with versioning for uploads, and Redis AOF/RDB persistence configuration.
    </div>

    <h3>CI/CD</h3>
    <p><strong>None configured.</strong> No GitHub Actions, Jenkins, or other CI files exist. No Dockerfiles for application services.</p>

    <div class="flag">
      <strong>âš  Flag:</strong> The BMAD dev-story workflow provides lint/test/build verification per story, but there is no automated pipeline for pull requests or deployments. Story 1.11 (CI/CD Pipeline Setup) was deferred to post-MVP.
    </div>
  </div>

  <!-- Section 7 -->
  <div class="section" id="s7">
    <h2><span class="section-num">7.</span> Folder Structure</h2>
    <pre>project_bubble/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api-gateway/                    # NestJS API backend
â”‚   â”‚   â””â”€â”€ src/app/
â”‚   â”‚       â”œâ”€â”€ auth/                   # JWT strategy, login, set-password
â”‚   â”‚       â”‚   â”œâ”€â”€ guards/             # JwtAuthGuard, OptionalJwtAuthGuard, RolesGuard
â”‚   â”‚       â”‚   â”œâ”€â”€ strategies/         # JwtStrategy (Passport)
â”‚   â”‚       â”‚   â””â”€â”€ decorators/         # @Roles() decorator
â”‚   â”‚       â”œâ”€â”€ guards/                 # AdminApiKeyGuard
â”‚   â”‚       â”œâ”€â”€ interceptors/           # TenantContextInterceptor
â”‚   â”‚       â”œâ”€â”€ tenants/                # Tenant CRUD + impersonation
â”‚   â”‚       â”œâ”€â”€ users/                  # User CRUD (app + admin controllers)
â”‚   â”‚       â”œâ”€â”€ invitations/            # Invitation CRUD (app + admin controllers)
â”‚   â”‚       â”œâ”€â”€ assets/                 # File upload/management
â”‚   â”‚       â”œâ”€â”€ ingestion/              # Document processing, embedding, BullMQ
â”‚   â”‚       â”œâ”€â”€ knowledge/              # Semantic search, validated insights
â”‚   â”‚       â”œâ”€â”€ workflows/              # Templates, versions, chains, catalog, runs
â”‚   â”‚       â””â”€â”€ email/                  # SMTP email service
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                            # Angular 21 SPA
â”‚   â”‚   â””â”€â”€ src/app/
â”‚   â”‚       â”œâ”€â”€ admin/                  # Admin portal (Zone C)
â”‚   â”‚       â”‚   â”œâ”€â”€ dashboard/          # Stats, tenant list, create modal
â”‚   â”‚       â”‚   â”œâ”€â”€ tenants/            # Tenant detail, user mgmt, impersonation
â”‚   â”‚       â”‚   â”œâ”€â”€ workflows/          # Wizard, chain builder, studio, templates
â”‚   â”‚       â”‚   â””â”€â”€ settings/           # Settings page shell (3.1-1)
â”‚   â”‚       â”œâ”€â”€ app/                    # Tenant app (Zone B)
â”‚   â”‚       â”‚   â””â”€â”€ data-vault/         # File manager, folders, upload
â”‚   â”‚       â”œâ”€â”€ auth/                   # Login, set-password (Zone A)
â”‚   â”‚       â”œâ”€â”€ core/                   # Services, guards, interceptors
â”‚   â”‚       â”‚   â”œâ”€â”€ services/           # 9 services (auth, tenant, asset, etc.)
â”‚   â”‚       â”‚   â”œâ”€â”€ guards/             # 4 guards (auth, admin, noAuth, unsaved)
â”‚   â”‚       â”‚   â””â”€â”€ interceptors/       # JWT interceptor
â”‚   â”‚       â””â”€â”€ shared/                 # Reusable components (badge, tooltip, etc.)
â”‚   â”‚
â”‚   â””â”€â”€ worker-engine/                  # BullMQ worker (empty shell)
â”‚       â””â”€â”€ src/app/                    # Placeholder for Epic 4
â”‚
â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ db-layer/                       # Database layer
â”‚   â”‚   â””â”€â”€ src/lib/
â”‚   â”‚       â”œâ”€â”€ entities/               # 11 TypeORM entities
â”‚   â”‚       â”œâ”€â”€ repositories/           # Custom repositories
â”‚   â”‚       â”œâ”€â”€ rls-setup.service.ts    # RLS policy initialization
â”‚   â”‚       â”œâ”€â”€ tenant-context.ts       # AsyncLocalStorage for tenant context
â”‚   â”‚       â””â”€â”€ transaction-manager.ts  # Tenant-aware transaction wrapper
â”‚   â”‚
â”‚   â””â”€â”€ shared/                         # Shared types &amp; DTOs
â”‚       â””â”€â”€ src/lib/
â”‚           â”œâ”€â”€ dtos/                   # 31 DTOs (auth, user, tenant, workflow, etc.)
â”‚           â”œâ”€â”€ types/                  # TypeScript interfaces
â”‚           â””â”€â”€ validators/             # Schema validators
â”‚
â”œâ”€â”€ _bmad/                              # BMAD multi-agent framework
â”‚   â”œâ”€â”€ bmm/                            # Project-specific agents, workflows, data
â”‚   â””â”€â”€ core/                           # Framework core (tasks, agents, resources)
â”‚
â”œâ”€â”€ _bmad-output/                       # Generated artifacts
â”‚   â”œâ”€â”€ planning-artifacts/             # PRD, architecture, epics, UX spec
â”‚   â””â”€â”€ implementation-artifacts/       # Stories, sprint status, test reviews
â”‚
â”œâ”€â”€ docker-compose.yml                  # PostgreSQL (pgvector) + Redis
â”œâ”€â”€ nx.json                             # Nx workspace config
â”œâ”€â”€ tsconfig.base.json                  # Root TypeScript config
â”œâ”€â”€ project-context.md                  # AI agent rules &amp; patterns
â””â”€â”€ package.json                        # 41 prod + 64 dev dependencies</pre>
  </div>

  <!-- Section 8 -->
  <div class="section" id="s8">
    <h2><span class="section-num">8.</span> Technical Debt &amp; Known Issues</h2>

    <h3>Critical Issues</h3>

    <h4>1. E2E Test Coverage is Zero</h4>
    <ul>
      <li><strong>575+ unit tests pass</strong>, but zero E2E/integration tests exist</li>
      <li>Unit tests mock all HTTP calls â€” actual API can return 500 on every endpoint without tests catching it</li>
      <li>Three startup crashes were discovered during manual UI testing, not by tests:
        <ul>
          <li>TypeORM entity registration missing (WorkflowRun, WorkflowChain, KnowledgeChunk)</li>
          <li>pgvector column type mismatch (float8[] vs vector(768))</li>
          <li>Circular dependency in lazy-loaded routes</li>
        </ul>
      </li>
      <li><strong>Stories created:</strong> 1E, 2E, 3E (all <code>ready-for-dev</code>)</li>
    </ul>
    <div class="flag flag-critical">
      <strong>ğŸš¨ Flag:</strong> This is the single biggest risk. The test suite provides false confidence. A single <code>nx serve api-gateway && curl /api/admin/tenants</code> would have caught the startup crashes.
    </div>

    <h4>2. No CI/CD Pipeline</h4>
    <ul>
      <li>No GitHub Actions, no automated checks on push/PR</li>
      <li>BMAD workflow provides per-story lint/test/build, but nothing prevents regressions between stories</li>
      <li><strong>Deferred:</strong> Story 1.11 (post-MVP)</li>
    </ul>

    <h4>3. Swagger @ApiResponse Gaps</h4>
    <ul>
      <li>11 controllers missing error response decorators (400, 401, 403, 500)</li>
      <li>API documentation is incomplete for error scenarios</li>
      <li><strong>Status:</strong> Not started</li>
    </ul>

    <h4>4. Worker Engine is Empty Shell</h4>
    <ul>
      <li>BullMQ jobs (ingestion, workflow execution) run inside api-gateway process</li>
      <li><code>apps/worker-engine/</code> exists but has no real job processors</li>
      <li><strong>Pragmatic MVP decision</strong> â€” will be activated in Epic 4</li>
    </ul>

    <h3>High Priority</h3>

    <h4>5. JWT Claims Missing User Info</h4>
    <ul>
      <li>JWT only contains <code>sub</code>, <code>tenant_id</code>, <code>role</code></li>
      <li>No <code>email</code> or <code>name</code> in claims â€” <code>getCurrentUser()</code> returns empty email</li>
      <li>Blocks Story 3.1-2 (avatar dropdown showing user name/email)</li>
      <li><strong>Fix needed:</strong> Either add claims to JWT or create <code>/api/users/me</code> endpoint</li>
    </ul>

    <h4>6. No Provider Credential Storage</h4>
    <ul>
      <li>Only <code>GEMINI_API_KEY</code> env var exists</li>
      <li>No encrypted credential storage for multiple LLM providers</li>
      <li><strong>Blocked by:</strong> Story 3.1-4 (Provider Credential Storage)</li>
    </ul>

    <h4>7. Missing Tenant Lifecycle</h4>
    <ul>
      <li>No archive/suspend/hard-delete flows for tenants</li>
      <li><strong>Story 1-13</strong> created but not started</li>
    </ul>

    <h4>8. Refresh Token Rotation Absent</h4>
    <ul>
      <li>JWT has 7-day expiry (interim hardening)</li>
      <li>No refresh tokens, no session extension, no revocation</li>
      <li><strong>Deferred to:</strong> Epic 7 Story 7.5</li>
    </ul>

    <h3>Medium Priority</h3>

    <h4>9. Defense-in-Depth Gaps</h4>
    <ul>
      <li>Some raw SQL queries in knowledge search and ingestion lack explicit <code>tenant_id</code> in WHERE clauses</li>
      <li>RLS provides the safety net, but best practice requires belt-and-suspenders</li>
      <li>Recurring issue: flagged in Stories 2.4, 3.3, 3.4</li>
    </ul>

    <h4>10. Audit Logging Not Implemented</h4>
    <ul>
      <li>Impersonation logged via <code>logger.warn</code> (placeholder)</li>
      <li>No structured audit trail for admin actions</li>
      <li><strong>Deferred to:</strong> Epic 7 Story 7.2</li>
    </ul>

    <h4>11. Health Check Endpoint Missing</h4>
    <ul>
      <li>No <code>/health</code> endpoint for monitoring</li>
      <li><strong>Deferred to:</strong> Epic 7 Story 7.3</li>
    </ul>

    <h4>12. Log Sanitization for PII</h4>
    <ul>
      <li>Document content and user data may appear in logs</li>
      <li>No sanitization layer implemented</li>
      <li><strong>Deferred to:</strong> Story 2.1 AC (when real document data flows through)</li>
    </ul>

    <h3>Low Priority</h3>
    <ul>
      <li>Tailwind CSS installed but not actively used (custom design system instead)</li>
      <li>Budget warning on <code>tenant-detail.component.scss</code> (6.50 kB vs 4.00 kB)</li>
      <li><code>app-layout.component.ts</code> has no logout functionality (Story 3.1-2 will add)</li>
    </ul>

    <h3>Deferred Architectural Decisions</h3>
    <table>
      <thead><tr><th>Decision</th><th>Status</th><th>Target</th></tr></thead>
      <tbody>
        <tr><td>LangGraph.js for workflow execution</td><td>Deferred indefinitely</td><td>YAML prompts to LLM instead</td></tr>
        <tr><td>Hexagonal LLM Provider interface</td><td><strong>GATE for Epic 4</strong></td><td>Must build before execution engine</td></tr>
        <tr><td>Knowledge graph (nodes + edges)</td><td>Phase 2</td><td>Vectors only for MVP</td></tr>
        <tr><td>Conversational intelligence ("Chat with Data")</td><td>Phase 2</td><td>Epic 8</td></tr>
        <tr><td>Advanced visual workflow canvas</td><td>Phase 2</td><td>Epic 10</td></tr>
        <tr><td>Plan tier management system</td><td>Future</td><td>Epic 11</td></tr>
        <tr><td>CI/CD pipeline</td><td>Post-MVP</td><td>Story 1.11</td></tr>
        <tr><td>BullMQ worker service extraction</td><td>Epic 4</td><td>When dedicated workers needed</td></tr>
      </tbody>
    </table>

    <h3>Process Issues (Documented, Actions Taken)</h3>
    <ol>
      <li><strong>"Acceptable for MVP" mindset</strong> â€” Phrase permanently banned. Used 3 times in Epic 2 to lower standards.</li>
      <li><strong>Code review auto-fix without consent</strong> â€” Code review now must present findings before fixing.</li>
      <li><strong>39 unsubscribed RxJS subscriptions</strong> â€” All fixed in Story 3H. ESLint rule + project-context.md Rule 13 now enforced.</li>
      <li><strong>Story codebase verification gaps</strong> â€” Stories referenced non-existent code/routes. Rules 14-20 added.</li>
    </ol>
  </div>

  <!-- Section 9 -->
  <div class="section" id="s9">
    <h2><span class="section-num">9.</span> Operational Gaps</h2>

    <h3>Performance &amp; Scale Expectations</h3>
    <p><strong>Documented targets from PRD (not tested or validated):</strong></p>
    <table>
      <thead><tr><th>Metric</th><th>Target</th><th>Source</th></tr></thead>
      <tbody>
        <tr><td>Evidence Drawer interactions</td><td>&lt; 200ms</td><td>PRD NFR</td></tr>
        <tr><td>Workflow submission acknowledgment</td><td>&lt; 2 seconds</td><td>PRD NFR</td></tr>
        <tr><td>Report rendering (up to 50 citations)</td><td>&lt; 3 seconds</td><td>PRD NFR</td></tr>
        <tr><td>Knowledge Base per tenant</td><td>Up to 10,000 nodes/edges</td><td>PRD NFR</td></tr>
        <tr><td>Concurrent runs per tenant</td><td>Configurable by plan tier (e.g., Tier 1: 5, Tier 2: 20)</td><td>PRD NFR</td></tr>
        <tr><td>API offloading rule</td><td>Any task &gt; 200ms â†’ BullMQ queue</td><td>Architecture decision</td></tr>
      </tbody>
    </table>

    <p><strong>What's missing:</strong></p>
    <ul>
      <li><strong>Expected user volume:</strong> No documented target for concurrent users, total tenants, or peak load. Rough estimate: ~150 customers Ã— 5-10 users = 750-1500 total users.</li>
      <li><strong>No load testing:</strong> Zero performance benchmarks exist. No k6, Artillery, or JMeter configs.</li>
      <li><strong>No capacity planning:</strong> Unknown how many tenants a single API gateway instance can serve.</li>
      <li><strong>No monitoring:</strong> No APM (DataDog, New Relic), no Prometheus metrics, no structured logging beyond console.</li>
      <li><strong>File size distribution:</strong> 10MB limit is hardcoded but no analysis of typical file sizes or total storage per tenant.</li>
    </ul>

    <div class="flag">
      <strong>âš  Flag:</strong> The architect needs concrete numbers to size infrastructure. Recommended: define target for Year 1 (e.g., 200 tenants, 2000 users, 500 workflow runs/day, 50GB total file storage), then validate with load testing before production launch.
    </div>

    <h3>Error Handling &amp; Retry Strategy</h3>
    <p><strong>BullMQ ingestion queue (the only queue currently configured):</strong></p>
    <pre>// ingestion.module.ts
defaultJobOptions: {
  attempts: 3,                                    // 3 retries after initial failure
  backoff: { type: 'exponential', delay: 5000 }, // 5s â†’ 10s â†’ 20s
  removeOnComplete: 100,                          // Keep last 100 completed
  removeOnFail: 500,                              // Keep last 500 failed
}</pre>

    <p><strong>Embedding service (LLM call retries):</strong></p>
    <ul>
      <li>Timeout: 30 seconds per batch (<code>EMBED_TIMEOUT_MS = 30_000</code>)</li>
      <li>Custom exponential backoff: 3 attempts, 1s base delay</li>
      <li>Batch size: max 100 texts per embedding call</li>
    </ul>

    <p><strong>What's missing:</strong></p>
    <table>
      <thead><tr><th>Gap</th><th>Impact</th></tr></thead>
      <tbody>
        <tr><td>No dead letter queue</td><td>Failed jobs sit in <code>failed</code> state with no routing or alerting. After 3 retries, the job is abandoned silently.</td></tr>
        <tr><td>No circuit breaker</td><td>If the LLM provider is down, every queued job burns through all retry attempts before failing. No fast-fail mechanism.</td></tr>
        <tr><td>No alerting on failures</td><td>Failed jobs only visible in BullMQ dashboard (not configured) or Redis directly. No email/Slack notification.</td></tr>
        <tr><td>No workflow execution queue</td><td>Only the <code>ingestion</code> queue exists. Workflow run execution (Epic 4) doesn't have a queue config yet.</td></tr>
        <tr><td>No partial failure recovery</td><td>If a chain workflow fails on step 3 of 5, there's no mechanism to resume from step 3. The entire chain must be re-run.</td></tr>
        <tr><td>No idempotency keys</td><td>Retried jobs could produce duplicate results if the first attempt partially succeeded.</td></tr>
      </tbody>
    </table>

    <div class="flag">
      <strong>âš  Flag:</strong> The retry strategy for ingestion is reasonable for MVP. However, before Epic 4 (workflow execution with real LLM calls and customer-facing credit charges), the architect should define: (1) dead letter queue routing, (2) circuit breaker thresholds per provider, (3) alerting integration, (4) idempotency guarantees for charged operations.
    </div>
  </div>

  <!-- Section 10: Summary -->
  <div class="section" id="s10">
    <h2><span class="section-num">10.</span> Summary &amp; Architect Decisions</h2>

    <div class="summary-grid">
      <div class="summary-card good">
        <h3>âœ… What's Working Well</h3>
        <ul>
          <li>RLS architecture is solid â€” tenant isolation enforced at DB level with TransactionManager</li>
          <li>Shared DTO library prevents frontend/backend drift</li>
          <li>Hexagonal provider pattern (embedding) ready for LLM extension</li>
          <li>575+ unit tests with consistent BDD format</li>
          <li>BMAD workflow provides structured dev process with code review</li>
          <li>BullMQ ingestion pipeline has sensible retry defaults</li>
        </ul>
      </div>
      <div class="summary-card decisions">
        <h3>ğŸ”µ Needs Architect Decisions</h3>
        <ul>
          <li>Deployment target (GCP vs AWS vs Railway)</li>
          <li>File storage backend (GCS vs S3)</li>
          <li>Secrets management approach</li>
          <li>Database hosting (Cloud SQL vs RDS vs Supabase)</li>
          <li>Auth bypass RLS policy security posture</li>
          <li>Monitoring stack selection</li>
        </ul>
      </div>
    </div>

    <h3>What Needs Architect Decisions</h3>
    <table>
      <thead><tr><th>Decision</th><th>Options</th><th>Blocking</th></tr></thead>
      <tbody>
        <tr><td>Deployment target</td><td>GCP (Cloud Run + Cloud SQL) vs AWS (AppRunner + RDS) vs Render/Railway</td><td>Everything below</td></tr>
        <tr><td>File storage backend</td><td>GCS bucket vs S3 vs managed service</td><td>Production readiness</td></tr>
        <tr><td>Secrets management</td><td>GCP Secret Manager vs AWS Secrets Manager vs Vault</td><td>Production readiness</td></tr>
        <tr><td>Database hosting</td><td>Cloud SQL vs RDS vs Supabase</td><td>Backup/DR strategy</td></tr>
        <tr><td>Auth bypass RLS policies</td><td>Restrict to dedicated DB role vs accept current design</td><td>Security posture</td></tr>
        <tr><td>Monitoring stack</td><td>DataDog vs Prometheus+Grafana vs cloud-native</td><td>Observability</td></tr>
      </tbody>
    </table>

    <h3>What Needs Attention Before Epic 4</h3>
    <table>
      <thead><tr><th>Priority</th><th>Item</th><th>Effort</th></tr></thead>
      <tbody>
        <tr><td>1</td><td>Complete Epic 3.1 (Settings shell done; 3 stories remain)</td><td>3 stories</td></tr>
        <tr><td>2</td><td>E2E test foundation (Stories 1E, 2E, 3E)</td><td>3 stories</td></tr>
        <tr><td>3</td><td>Build LLM Provider interface (MockLlmProvider + GoogleAIStudioProvider)</td><td>1-2 stories</td></tr>
        <tr><td>4</td><td>Swagger @ApiResponse gaps</td><td>1 story</td></tr>
        <tr><td colspan="2"><strong>Total</strong></td><td><strong>8-9 stories</strong></td></tr>
      </tbody>
    </table>

    <h3>What Needs Attention Before Production</h3>
    <table>
      <thead><tr><th>Priority</th><th>Item</th><th>Severity</th></tr></thead>
      <tbody>
        <tr><td>1</td><td>Choose deployment target and create Dockerfiles</td><td><span class="badge badge-critical">Critical</span></td></tr>
        <tr><td>2</td><td>Migrate file storage to cloud object storage</td><td><span class="badge badge-critical">Critical</span></td></tr>
        <tr><td>3</td><td>Implement secrets management</td><td><span class="badge badge-critical">Critical</span></td></tr>
        <tr><td>4</td><td>Set up automated database backups</td><td><span class="badge badge-critical">Critical</span></td></tr>
        <tr><td>5</td><td>Add dead letter queue + alerting for BullMQ</td><td><span class="badge badge-high">High</span></td></tr>
        <tr><td>6</td><td>Load test against performance NFRs</td><td><span class="badge badge-high">High</span></td></tr>
        <tr><td>7</td><td>Review auth bypass RLS policies with security lens</td><td><span class="badge badge-high">High</span></td></tr>
        <tr><td>8</td><td>CI/CD pipeline (Story 1.11)</td><td><span class="badge badge-high">High</span></td></tr>
        <tr><td>9</td><td>Health check endpoint (Story 7.3)</td><td><span class="badge badge-medium">Medium</span></td></tr>
        <tr><td>10</td><td>Monitoring and observability (Epic 7)</td><td><span class="badge badge-medium">Medium</span></td></tr>
      </tbody>
    </table>
  </div>

</div>
</body>
</html>
