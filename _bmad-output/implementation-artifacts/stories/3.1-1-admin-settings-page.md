# Story 3.1-1: Admin Settings Page Shell & Navigation

Status: done

## Story

**As a** Bubble Admin,
**I want** a Settings page with tabbed navigation accessible from the admin sidebar,
**So that** system-level configuration features have a dedicated home in the UI.

## Background

The admin navigation previously included a Settings link pointing to `/admin/settings`, but no route or component existed (404). The link was removed in Story 3.2. This story creates the page shell — the actual settings content (LLM models, provider credentials) is handled by subsequent stories.

### Codebase Context (Verified)

**Admin routing** — `apps/web/src/app/app.routes.ts:29-104`: Admin routes are lazy-loaded under `path: 'admin'` with `authGuard` + `adminGuard`. No `/admin/settings` route exists.

**Admin sidebar** — `apps/web/src/app/admin/admin-layout.component.ts:26-30`: Navigation items are a static array:
```typescript
navItems: NavItem[] = [
  { label: 'Dashboard', icon: 'layout-dashboard', route: '/admin/dashboard' },
  { label: 'Tenants', icon: 'building-2', route: '/admin/tenants' },
  { label: 'Workflow Studio', icon: 'git-branch', route: '/admin/workflows' },
];
```

**Admin layout template** — `apps/web/src/app/admin/admin-layout.component.html`: Sidebar with nav items rendered via `@for`, main content via `<router-outlet />`.

**Guards** — `adminGuard` already restricts the entire `/admin` path to `bubble_admin` role.

## Acceptance Criteria

1. **Route exists** — `/admin/settings` renders the settings page component
2. **Navigation link** — Settings link appears in admin sidebar (after Workflow Studio, before footer)
3. **Tabbed layout** — Settings page has a tab bar with "LLM Models" tab (active) and "System" tab (disabled/coming soon)
4. **LLM Models tab** — Shows placeholder text "LLM model management — coming in Story 3.1-3"
5. **System tab** — Disabled with "Coming soon" tooltip
6. **Role restriction** — Page is only accessible to bubble_admin (inherited from admin route guard)
7. **Page title** — "Settings" heading with settings icon

## Tasks

### Task 1: Create Settings Page Component
- [x] Create `apps/web/src/app/admin/settings/settings.component.ts` (standalone)
- [x] Create template with page header (lucide `settings` icon + "Settings" title)
- [x] Implement tab bar with two tabs: "LLM Models" (active), "System" (disabled)
- [x] LLM Models tab content: placeholder card with message for Story 3.1-3
- [x] System tab: disabled state with "Coming soon" visual indicator
- [x] Create `settings.component.scss` matching existing admin page styles (reference `dashboard.component.scss`)
- [x] Add `data-testid` attributes: `settings-page`, `tab-llm-models`, `tab-system`

### Task 2: Add Route & Navigation
- [x] Add lazy-loaded route to `apps/web/src/app/app.routes.ts` under admin children: `{ path: 'settings', loadComponent: ... }`
- [x] Add Settings nav item to `admin-layout.component.ts` navItems array: `{ label: 'Settings', icon: 'settings', route: '/admin/settings' }`

### Task 3: Unit Tests
- [x] Settings component creates successfully
- [x] Tab bar renders with correct tabs
- [x] LLM Models tab shows placeholder content
- [x] System tab is disabled
- [x] Settings nav item appears in admin sidebar

## Test Traceability

| AC | Test File | Test ID | Status |
|----|-----------|---------|--------|
| AC1: Route exists | settings.component.spec.ts | 3.1-1-UNIT-001 (creates) | Pass |
| AC2: Nav link | admin-layout.component.spec.ts | 1H.1-UNIT-002 (4 nav items), 1H.1-UNIT-003 (labels include Settings) | Pass |
| AC3: Tabbed layout | settings.component.spec.ts | 3.1-1-UNIT-004 (2 tabs), 3.1-1-UNIT-005 (LLM active) | Pass |
| AC4: LLM Models placeholder | settings.component.spec.ts | 3.1-1-UNIT-006 | Pass |
| AC5: System tab disabled | settings.component.spec.ts | 3.1-1-UNIT-007, 3.1-1-UNIT-008 (Coming soon badge) | Pass |
| AC6: Role restriction | Inherited from admin route guard (app.routes.ts:32) | N/A — structural | Pass |
| AC7: Page title | settings.component.spec.ts | 3.1-1-UNIT-003 | Pass |
| A11y: ARIA tabs | settings.component.spec.ts | 3.1-1-UNIT-010 | Pass |

## Files to Create/Modify

| File | Action | Details |
|------|--------|---------|
| `apps/web/src/app/admin/settings/settings.component.ts` | CREATE | Settings page shell with tabbed layout |
| `apps/web/src/app/admin/settings/settings.component.html` | CREATE | Template with tabs and placeholder content |
| `apps/web/src/app/admin/settings/settings.component.scss` | CREATE | Styles matching admin design system |
| `apps/web/src/app/admin/settings/settings.component.spec.ts` | CREATE | Unit tests (10 tests) |
| `apps/web/src/app/app.routes.ts` | MODIFY | Add `/admin/settings` route (line ~103, before default redirect) |
| `apps/web/src/app/admin/admin-layout.component.ts` | MODIFY | Add Settings to navItems array (line 29) |
| `apps/web/src/app/admin/admin-layout.component.spec.ts` | MODIFY | Update nav item count (3→4), add Settings icon import |

## Definition of Done

- [x] All acceptance criteria met
- [x] All tests pass
- [x] Lint passes
- [x] Code review passed

## Senior Developer Review (AI)

**Reviewer:** erinc | **Date:** 2026-02-05 | **Verdict:** PASS (after fixes)

### Findings (5 issues — 0H, 3M, 2L)

| ID | Severity | Description | Resolution |
|----|----------|-------------|------------|
| M1 | Medium | Missing `aria-controls`, `id`, `role="tabpanel"` on tab content (incomplete WAI-ARIA tabs pattern) | Fixed: Added `id`, `aria-controls` to tabs, `role="tabpanel"` + `aria-labelledby` to panel. Added UNIT-010 test. |
| M2 | Medium | `admin-layout.component.spec.ts` modified but not listed in story File List | Fixed: Added to File List table |
| M3 | Medium | Tests missing BDD Given/When/Then comments (Rule 12b, Epic 3+) | Fixed: Added BDD comments to all 10 tests |
| L1 | Low | `gap: 0` in `.tab-bar` is a no-op (default flexbox value) | Fixed: Removed redundant CSS |
| L2 | Low | Story tasks not marked `[x]`, status still `ready-for-dev` | Fixed: All tasks marked, status → done |

## Change Log

| Date | Author | Changes |
|------|--------|---------|
| 2026-02-04 | Retrospective | Original story created from Epic 3 discussion item #4 |
| 2026-02-04 | Restructure | Moved from 7-6 to 3.1-1 (Epic 3.1) |
| 2026-02-05 | Quality Review | REWRITTEN — original story failed quality review (no codebase verification, scope too large, invented non-existent env vars). Split into 3 stories: 3.1-1 (shell), 3.1-3 (LLM model UI), 3.1-4 (provider credentials). |
| 2026-02-05 | Dev + Review | Implemented all 3 tasks. Code review: 5 fixes applied (M1-M3, L1-L2). 301 tests, 0 lint errors. |
