# Story 3.1-2: Logout Button & Avatar Dropdown

Status: ready-for-dev

## Story

**As a** User (any role),
**I want** a user avatar dropdown menu replacing the standalone logout button,
**So that** I have a professional, consistent way to access my profile info, settings, and logout across all layouts.

## Background

The current logout button in the admin sidebar footer is a plain text button that looks unfinished. This needs to be replaced with a user avatar dropdown menu that:
- Shows user initials or avatar
- Provides dropdown with: profile info, settings link, logout
- Applies to ALL layout components (admin-layout and app-layout)
- Works for all user roles (bubble_admin, tenant users)

This was identified during Story 3.2 UI testing and captured as Epic 3 retro item #1/#7.

## Acceptance Criteria

1. **Avatar Component** - User avatar shows initials (first+last) with colored background
2. **Dropdown Menu** - Click avatar opens dropdown with: display name, email, role badge, divider, Settings link, Logout action
3. **Admin Layout** - Avatar dropdown replaces logout button in admin-layout sidebar footer
4. **App Layout** - Avatar dropdown replaces logout button in app-layout header
5. **Logout Action** - Clicking logout clears auth state and redirects to login
6. **Settings Link** - Links to /admin/settings (Story 3.1-1)
7. **Click Outside** - Dropdown closes when clicking outside
8. **Test IDs** - All interactive elements have data-testid attributes

## Tasks

### Task 1: Create Avatar Dropdown Component
- [ ] Create `avatar-dropdown.component.ts` as standalone component
- [ ] Display user initials with colored background (derive from name)
- [ ] Dropdown panel: name, email, role badge, divider, Settings, Logout
- [ ] Click outside to close (HostListener or CDK overlay)
- [ ] Add data-testid attributes

### Task 2: Integrate into Admin Layout
- [ ] Replace logout button in `admin-layout.component.ts` sidebar footer
- [ ] Wire up logout action to existing auth service
- [ ] Wire up settings link to /admin/settings

### Task 3: Integrate into App Layout
- [ ] Replace logout button in `app-layout.component.ts` header
- [ ] Same dropdown behavior as admin layout

### Task 4: Unit Tests
- [ ] Avatar dropdown renders with user initials
- [ ] Dropdown opens/closes on click
- [ ] Logout action calls auth service
- [ ] Settings link navigates correctly
- [ ] Click outside closes dropdown
- [ ] Test both admin-layout and app-layout integration

### Task 5: Documentation Subtask (Rule 17)
- [ ] Tooltip on avatar hover showing full name
- [ ] Accessible labels for screen readers

## Definition of Done

- [ ] All acceptance criteria met
- [ ] All tests pass
- [ ] Lint passes
- [ ] Build succeeds
- [ ] Code review passed
- [ ] AC-to-test traceability table complete (Rule 12b)

## Change Log

| Date | Author | Changes |
|------|--------|---------|
| 2026-02-04 | Retrospective | Extracted from Story 7-7 (UI Polish Pass) task 4, Epic 3 retro items #1, #7 |
| 2026-02-04 | Restructure | Created as 3.1-2 in Epic 3.1: Settings & Essentials |
