# generated: 2026-01-30
# project: project_bubble
# project_key: bubble
# tracking_system: file-system
# story_location: stories

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Epic Status Transitions:
#   - backlog → in-progress: Automatically when first story is created (via create-story)
#   - in-progress → done: Manually when all stories reach 'done' status
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - ready-for-dev: Story file created in stories folder
#   - in-progress: Developer actively working on implementation
#   - review: Ready for code review (via Dev's code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - done: Retrospective has been completed
#
# WORKFLOW NOTES:
# ===============
# - Epic transitions to 'in-progress' automatically when first story is created
# - Stories can be worked in parallel if team capacity allows
# - SM typically creates next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', then runs code-review (fresh context, different LLM recommended)
#
# PHASE SCOPE:
# ============
# Prototype (Phase 1): Epics 1-7 (7 epics, stories updated 2026-02-02 for architectural pivot)
# Phase 2 / Future:    Epics 8, 9, 10, 11 (4 epics, 10 stories)
#
# DEPENDENCY CHAIN:
# Epic 1 → Epic 1H (hardening) → Epic 2 + Epic 3 (parallel) → Epic 4 → Epic 5 → Epic 6
# Epic 7 runs parallel to Epics 4-6
#
# GATE REQUIREMENTS:
# ==================
# BEFORE Epic 3: Run /bmad:bmm:workflows:quick-spec for Workflow Definition Schema.
#   (UPDATED 2026-02-01: LangGraph.js DEFERRED — replaced by LLM-orchestrated execution)
#   Scope: YAML workflow schema for atomic workflows, input role taxonomy (context vs subject),
#   execution patterns (fan-out parallel, fan-in batch), workflow chain composition,
#   output spec and structural validation, context window token budget check.
#   Rationale: Epic 3 builds the UI that PRODUCES YAML workflow definitions; Epic 4 builds
#   the engine that CONSUMES them. The YAML schema contract must be defined first so the
#   form builder produces exactly what the execution engine needs. No rework.
#   This tech spec MUST be completed before any Epic 3 story is created.
#
# BEFORE Epic 4 Story 4.1 or 4.2: Build Mock LLM Provider alongside real providers.
#   The architecture specifies a Hexagonal LLM pattern (abstract provider interface).
#   - MockLlmProvider: Returns deterministic canned responses. Free, instant, for dev + unit tests.
#   - VertexLlmProvider: Real Google Vertex AI calls (paid). For production.
#   - GoogleAIStudioProvider: Free tier Google AI Studio API. For smoke tests + dev validation.
#   - Switched via LLM_PROVIDER env var (mock | google-ai-studio | vertex).
#   - Create a "smoke test" workflow (2 steps, 1-2 small docs) for real LLM validation.
#   - Mock provider covers engine logic (graph execution, state, retries, feedback loop).
#   - Google AI Studio (free tier) for real LLM integration testing without cost.
#   - Vertex AI for production workloads.
#   LLM TESTING STRATEGY:
#   - 90% development: MockLlmProvider (free, deterministic, fast)
#   - 10% validation: GoogleAIStudioProvider (free tier, real LLM responses)
#   - Production: VertexLlmProvider (paid, scalable)
#
# AFTER MVP Delivery (Epics 1-7 complete):
#   1. Implement Husky git pre-push hook (nx affected:test + nx affected:lint).
#      Rationale: BMAD workflow already runs full lint/test/build on every story,
#      but Husky adds a safety net for any future non-BMAD pushes.
#   2. Story 1.11: CI/CD Pipeline Setup (GitHub Actions).
#   3. Docker Compose for local full-stack orchestration.
#   4. Production deployment (cloud hosting, migrations, secrets management).
#
# DEFERRED DECISIONS:
# ===================
# - Story 1.11 (CI/CD) deferred to post-MVP. BMAD workflow provides equivalent
#   lint/test/build verification on every story. Solo dev, no PR workflow yet.
# - Story 1.12 (Invitations) story created, ready-for-dev. Not blocking Epic 2/3.
# - MVP runs entirely on laptop: Angular + NestJS + Postgres (Docker) + Redis (Docker) + Vertex AI API key.
# - synchronize:true for dev. Switch to TypeORM migrations before production deployment.
#
# DEFERRED: DEFENSE-IN-DEPTH HARDENING
# =====================================
# Story 2.4 code review (M3): Some raw SQL queries (e.g., getByRun) rely on RLS alone
# for tenant scoping without explicit tenant_id in WHERE clause. While safe due to RLS,
# adding explicit tenant_id provides defense-in-depth. This should be applied holistically
# across ALL raw SQL in the codebase (knowledge-search, validated-insight, ingestion)
# as a dedicated hardening story rather than piecemeal. Add to Epic 7 or a future
# hardening sprint.
# Raised during Story 2.4 code review (2026-02-01).

# IMMEDIATE POST-EPIC-2 ACTION:
# =============================
# - Swagger @ApiResponse gap fix: Add missing error response decorators (400, 401, 403, 500)
#   to ALL existing controllers across Epic 1 and Epic 2. Rule added to project-context.md
#   to prevent this gap in all future epics. Must be done before Epic 3 starts.
#   Controllers to fix: AuthController, TenantsController, UsersController,
#   InvitationsController, AssetsController, FoldersController, IngestionController,
#   KnowledgeController, AppController.
#   Raised during Story 2.3 code review (2026-02-01).
#
# FUTURE EPIC CONSIDERATION:
# ==========================
# - Knowledge Base Browsing/Viewing UI: Admin and tenant-facing UI to browse stored
#   RAG data (indexed chunks, embeddings metadata), search the knowledge base interactively,
#   and view per-tenant knowledge health. Could be part of Epic 8 or a new epic.
#   Raised during Story 2.3 creation (2026-02-01).

generated: 2026-01-30
project: project_bubble
project_key: bubble
tracking_system: file-system
story_location: stories

development_status:
  # ═══════════════════════════════════════════════════════
  # Epic 1: Tenant Management & Platform Setup
  # FRs: FR30, FR33, FR26, FR27, FR28, FR32, FR51
  # ═══════════════════════════════════════════════════════
  epic-1: done
  1-1-monorepo-infrastructure-initialization: done
  1-2-tenant-provisioning-api: done
  1-3-bubble-admin-dashboard-the-lobby: done
  1-4-impersonation-action: done
  1-5-tenant-configuration-credits-entitlements: done
  1-6-tenant-seeding-templates: skipped # FR51 obsoleted by workflow-centric visibility (Epic 3 design decision)
  1-7-user-authentication-rbac: done
  1-8-rls-enforcement-mechanism-security: done
  1-9-user-management-admin-creation: done
  1-10-login-password-pages-auth-ui: done
  1-11-ci-cd-pipeline-setup: deferred # Moved to post-MVP. BMAD workflow covers lint/test/build per story.
  1-12-user-invitations-email-flow: done
  epic-1-retrospective: done
  epic-1-nfr-assessment: done # NFR assessment completed 2026-01-31, FAIL status, hardening story required

  # ═══════════════════════════════════════════════════════
  # Epic 1H: Security & Reliability Hardening
  # Cross-cutting fixes from NFR assessment (2026-01-31)
  # Must complete before Epic 2 starts
  # ═══════════════════════════════════════════════════════
  epic-1h: done
  1h-1-security-reliability-hardening: done # All 7 tasks done, code review passed, 237 tests passing

  # ═══════════════════════════════════════════════════════
  # Epic 2: Asset & Knowledge Management
  # FRs: FR23, FR48, FR3, FR21, FR22
  # ═══════════════════════════════════════════════════════
  epic-2: done
  2-1-asset-management-tenant-shared-drive: done
  2-2-vector-ingestion-reference-assets: done
  2-3-semantic-search-service-vector-rag: done
  2-4-validated-insight-storage-memory: done # Code review passed, 406 tests, 0 lint errors
  epic-2-retrospective: done # Retrospective completed 2026-02-01. 3 critical process failures documented. Action items defined.

  # ═══════════════════════════════════════════════════════
  # Pre-Epic-3 Gates
  # ═══════════════════════════════════════════════════════
  gate-swagger-api-response: done # All 11 controllers, 42 endpoints documented. 406 tests, 0 errors.
  gate-workflow-definition-schema: done # Tech spec approved 2026-02-02. 12 tasks, 13 ACs, 20 technical decisions. Party mode DB review complete (10 findings applied).

  # ═══════════════════════════════════════════════════════
  # Epic 3: Workflow Definition (Atomic Workflows, Chains, Wizard)
  # FRs: FR1, FR2, FR4, FR5, FR6, FR35, FR42
  # REWRITTEN 2026-02-02: All stories updated for party mode architectural pivot.
  # Old node-based stories (3.1-3.6 + 3.2b) replaced with atomic workflow architecture.
  # ═══════════════════════════════════════════════════════
  epic-3: in-progress
  3-1-workflow-definition-data-foundation: done # Code review passed, 7 fixes applied, 453 tests, 0 lint errors
  3-2-workflow-builder-wizard-admin-ui: backlog
  3-3-workflow-template-crud-api: backlog
  3-4-workflow-versioning-publishing: backlog
  3-5-workflow-visibility-access-control: backlog
  3-6-workflow-chain-builder: backlog
  3-7-workflow-studio-template-library: backlog
  epic-3-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 4: Workflow Execution Engine (The Creator)
  # FRs: FR7-FR13, FR34, FR36, FR37, FR46, FR47
  # REWRITTEN 2026-02-02: Updated for LLM-orchestrated execution, fan-out/fan-in, chain orchestration.
  # ═══════════════════════════════════════════════════════
  epic-4: backlog
  4-1-workflow-catalog-run-initiation: backlog
  4-2-llm-provider-interface-prompt-assembly: backlog
  4-3-execution-engine-core-fan-out-fan-in: backlog
  4-4-pre-flight-validation-credit-check: backlog
  4-5-output-validation-storage: backlog
  4-6-workflow-chain-orchestration: backlog
  epic-4-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 5: Interactive Reporting & Feedback Loop
  # FRs: FR14-FR19, FR43, FR45
  # ═══════════════════════════════════════════════════════
  epic-5: backlog
  5-1-interactive-report-dashboard: backlog
  5-2-evidence-drawer-progressive-disclosure: backlog
  5-3-human-in-the-loop-feedback-multi-modal: backlog
  5-4-feedback-processing-the-re-run: backlog
  5-5-pdf-export-service: backlog
  epic-5-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 6: Guest Access & Sharing
  # FRs: FR20, FR39, FR40
  # ═══════════════════════════════════════════════════════
  epic-6: backlog
  6-1-magic-link-generator-service: backlog
  6-2-guest-access-guard-middleware: backlog
  6-3-guest-report-viewer-read-only: backlog
  epic-6-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 7: Observability & Advanced Operations
  # FRs: FR29, FR31, FR38, FR49
  # ═══════════════════════════════════════════════════════
  epic-7: backlog
  7-1-llm-model-provider-management: backlog
  7-2-audit-logging-service-security: backlog
  7-3-service-status-monitor: backlog
  7-4-admin-execution-inspector: backlog
  7-5-refresh-token-rotation: backlog # NFR deferred item — replaces interim 7-day JWT expiry from hardening story
  epic-7-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 8: Conversational Intelligence (Future Roadmap)
  # FRs: FR52, FR53
  # ═══════════════════════════════════════════════════════
  epic-8: backlog
  8-1-chat-with-report-scoped-rag: backlog
  8-2-chat-with-company-global-rag: backlog
  epic-8-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 9: Knowledge Graph Evolution (Phase 2)
  # ═══════════════════════════════════════════════════════
  epic-9: backlog
  9-1-relational-edge-extraction: backlog
  9-2-visual-graph-explorer: backlog
  9-3-smart-ingestion-pipelines: backlog
  epic-9-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 10: Advanced Visual Definition (Future MVP v2)
  # ═══════════════════════════════════════════════════════
  epic-10: backlog
  10-1-visual-graph-canvas: backlog
  10-2-visual-cycle-detection: backlog
  epic-10-retrospective: optional

  # ═══════════════════════════════════════════════════════
  # Epic 11: Plan Tier Management & Template System (Future)
  # Dependencies: Epic 1
  # ═══════════════════════════════════════════════════════
  epic-11: backlog
  11-1-tier-definition-crud: backlog
  11-2-tier-to-tenant-auto-apply: backlog
  11-3-per-tenant-override: backlog
  epic-11-retrospective: optional
