<div class="data-vault" data-testid="data-vault">
  <!-- Sidebar: Folder tree -->
  <aside class="folder-sidebar" data-testid="folder-sidebar">
    <div class="folder-header">
      <h3>Folders</h3>
      <button class="btn-icon" title="New folder" data-testid="new-folder-btn" (click)="showCreateFolder.set(true)">
        <lucide-icon name="folder-plus" [size]="18"></lucide-icon>
      </button>
    </div>
    <app-folder-tree
      [folders]="folders()"
      [activeFolderId]="activeFolderId()"
      (folderSelect)="onFolderSelect($event)"
      (folderRename)="onFolderRename($event)"
    />
  </aside>

  <!-- Main area -->
  <section class="vault-main">
    <!-- Header bar -->
    <div class="vault-header">
      <div class="header-left">
        <h2>Data Vault</h2>
        <span class="file-count">{{ filteredAssets().length }} files</span>
      </div>
      <div class="header-right">
        <div class="search-box">
          <lucide-icon name="search" [size]="16"></lucide-icon>
          <input
            type="text"
            placeholder="Search files..."
            data-testid="search-input"
            [value]="searchQuery()"
            (input)="onSearchInput($event)"
          />
        </div>
        <button class="btn-icon" title="Toggle view" data-testid="view-toggle-btn" (click)="toggleView()">
          <lucide-icon [name]="viewMode() === 'grid' ? 'list' : 'layout-grid'" [size]="18"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Bulk actions -->
    @if (selectedIds().size > 0) {
      <div class="bulk-actions" data-testid="bulk-actions">
        <span>{{ selectedIds().size }} selected</span>
        <button class="btn-primary-sm" data-testid="learn-selected-btn" (click)="indexSelected()" title="Adding to Knowledge Base means Bubble's AI agents will permanently learn from this file across all workflows.">Learn This</button>
        <button class="btn-danger-sm" data-testid="archive-selected-btn" (click)="deleteSelected()">Archive</button>
      </div>
    }

    <!-- File grid / list -->
    <div class="file-area" data-testid="file-area" [ngClass]="viewMode()">
      @if (loading()) {
        <div class="loading" data-testid="loading-indicator">Loading...</div>
      } @else if (filteredAssets().length === 0) {
        <div class="empty-state" data-testid="empty-state">
          <lucide-icon name="file-x" [size]="48"></lucide-icon>
          <p>No files found</p>
        </div>
      } @else {
        @for (asset of filteredAssets(); track asset.id) {
          <app-file-card
            [asset]="asset"
            [selected]="selectedIds().has(asset.id)"
            [viewMode]="viewMode()"
            [indexing]="indexingIds().has(asset.id)"
            (toggleSelect)="toggleSelect(asset.id)"
            (index)="onIndexAsset(asset.id)"
            (deIndex)="onDeIndexAsset(asset.id)"
          />
        }
      }
    </div>

    <!-- Upload zone -->
    <app-upload-zone
      [folderId]="activeFolderId()"
      (uploadComplete)="onUploadComplete()"
    />
  </section>
</div>

<!-- Create folder dialog -->
@if (showCreateFolder()) {
  <app-create-folder-dialog
    [parentId]="activeFolderId()"
    (created)="onFolderCreated()"
    (cancelled)="showCreateFolder.set(false)"
  />
}
