# tenant-id-allowlist.conf
# Rule 2c permanent exceptions — project-context.md §"EXEMPTED SERVICES" + §"Documented Rule 2c Exceptions"
#
# FORMAT:
#   - Entries containing '.' or '/' → file path substring match (suppresses whole file)
#   - Other entries → context match (suppresses violations within 30 lines of the pattern)
#
# Every entry MUST have a justification comment immediately above it.
# Adding entries here without justification is a process violation.
# Temporary deferrals are NOT allowed — only permanent architectural exceptions belong here.

# ── File-level exceptions ─────────────────────────────────────────────────────

# auth.service.ts — Pre-authentication service. Login requires cross-tenant user lookup by email.
# Seed admin creation runs at startup before any tenant context exists.
# Table: users. Both use cases require tenantId-free queries by design.
auth.service.ts

# invitations.service.ts — Pre-authentication (accept: user has no JWT yet).
# Create checks global email uniqueness cross-tenant. Same pattern as AuthService.
# Table: invitations. Application-level cross-tenant access is intentional.
invitations.service.ts

# tenants.service.ts — Admin-scoped service. The 'tenants' table has NO tenant_id column.
# Bubble admins manage the tenant registry itself; RLS does not apply.
tenants.service.ts

# llm-models.service.ts — System-wide model registry. The 'llm_models' table has NO tenant_id column.
# All tenants read the same shared model list. No tenant isolation needed.
llm-models.service.ts

# llm-provider-config.service.ts — System-wide provider configuration. No tenant_id column.
# Provider credentials are global admin settings, not per-tenant.
llm-provider-config.service.ts

# llm-provider.factory.ts — Reads system-wide llm_models and llm_provider_configs entities.
# Both tables have no tenant_id column. Factory is instantiated per-request with tenant context
# handled at the caller level (workflow-execution), not at the factory level.
llm-provider.factory.ts

# model-reassignment.service.ts — Admin-bypass service with explicit SET LOCAL app.is_admin = 'true'.
# Operates across all tenants by design (admin reassigns deprecated models globally).
# Uses manager.query() with explicit admin context, not tenant-scoped operations.
model-reassignment.service.ts

# ── Context-level exceptions (method name patterns) ───────────────────────────

# findPublishedOne — WorkflowTemplatesService method. Queries published catalog templates
# without tenantId because templates are created by bubble_admin and shared cross-tenant.
# Visibility enforced in application code (PRIVATE checks allowedTenants array).
# RLS policy 'catalog_read_published' provides database-level enforcement.
# Approved: Live Test Round 1 party mode triage (2026-02-12). project-context.md §2c.
findPublishedOne

# findPublished — WorkflowTemplatesService list method. Same rationale as findPublishedOne.
# Visibility filter: SQL `(visibility = 'public' OR tenantId = ANY(allowed_tenants))`.
findPublished

# findAccessibleByTenant — WorkflowTemplatesService. Same catalog access rationale.
# Returns templates accessible to the requesting tenant via catalog visibility rules.
findAccessibleByTenant

# findPublishedOneEntity — WorkflowTemplatesService. Returns raw entity for workflow execution.
# Same visibility logic as findPublishedOne. Used by initiateRun() for cross-tenant template access.
# RLS policies 'catalog_read_published' + 'template_access' provide database-level enforcement.
# Added: Story 4-LT4-3. project-context.md §"Documented Rule 2c Exceptions".
findPublishedOneEntity
